{% assign button = include %}
{% assign button = button | hash_default: site.data.types[include.type] %}

{%- comment -%}
Normalize link into safe string
Handles accidental array input
{%- endcomment -%}

{% assign url = button.link %}

{% if url and url.first and url.last %}
  {% assign url = url | last %}
{% endif %}

{%- comment -%}
Apply $VALUE substitution if needed
{%- endcomment -%}

{% if url and url contains "$VALUE" and include.link %}
  {% assign url = url | replace: "$VALUE", include.link %}
{% endif %}

{% if button.link or button.icon or button.text %}

  <div class="button-wrapper">

    {% assign final_url = url %}

    {% unless final_url contains "://" or final_url contains "mailto:" or final_url contains "tel:" %}
      {% assign final_url = final_url | relative_url %}
    {% endunless %}

    <a
      class="button"
      href="{{ final_url }}"
      {% if button.tooltip %}
        data-tooltip="{{ button.tooltip | xml_escape }}"
      {% endif %}
      data-style="{{ include.style }}"
      {% if include.flip %}
        data-flip
      {% endif %}
      aria-label="{{ button.tooltip | default: button.icon | default: "button" | regex_strip }}"
    >
      {% include icon.html icon=button.icon %}
      {% if button.text %}
        <span>{{ button.text }}</span>
      {% endif %}
    </a>

  </div>

{% endif %}
